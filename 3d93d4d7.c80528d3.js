(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{123:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return c})),r.d(t,"metadata",(function(){return l})),r.d(t,"toc",(function(){return p})),r.d(t,"default",(function(){return u}));var o=r(3),n=r(7),a=(r(0),r(371)),i=r(374),s=r(376),c={title:"Post-processing"},l={unversionedId:"generators/post-process",id:"version-2.0.0-alpha.8/generators/post-process",isDocsHomePage:!1,title:"Post-processing",description:"After a level is generated, we may often want to run some additional logic like spawning enemies, etc. This can be achieved by providing your own post-processing logic that will be called after the level is generated and provided with information about the level.",source:"@site/versioned_docs\\version-2.0.0-alpha.8\\generators\\post-process.md",slug:"/generators/post-process",permalink:"/Edgar-Unity-DocsArchive/docs/2.0.0-alpha.8/generators/post-process",editUrl:"https://github.com/OndrejNepozitek/Edgar-Unity/tree/docusaurus/versioned_docs/version-2.0.0-alpha.8/generators/post-process.md",version:"2.0.0-alpha.8",sidebar:"version-2.0.0-alpha.8/docs",previous:{title:"Dungeon generator",permalink:"/Edgar-Unity-DocsArchive/docs/2.0.0-alpha.8/generators/dungeon-generator"},next:{title:"(PRO) Platformer generator",permalink:"/Edgar-Unity-DocsArchive/docs/2.0.0-alpha.8/generators/platformer-generator"}},p=[{value:"Built-in post-processing steps",id:"built-in-post-processing-steps",children:[{value:"0. Instantiate room template with correct positions",id:"0-instantiate-room-template-with-correct-positions",children:[]},{value:"1. Initialize shared tilemaps",id:"1-initialize-shared-tilemaps",children:[]},{value:"2. Copy rooms to shared tilemaps",id:"2-copy-rooms-to-shared-tilemaps",children:[]},{value:"3. Center grid",id:"3-center-grid",children:[]},{value:"4. Disable room template renderers",id:"4-disable-room-template-renderers",children:[]},{value:"5. Disable room template colliders",id:"5-disable-room-template-colliders",children:[]}]},{value:"Custom post-processing",id:"custom-post-processing",children:[{value:"(PRO) Priority callbacks",id:"pro-priority-callbacks",children:[]}]}],d={toc:p};function u(e){var t=e.components,r=Object(n.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},d,r,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"After a level is generated, we may often want to run some additional logic like spawning enemies, etc. This can be achieved by providing your own post-processing logic that will be called after the level is generated and provided with information about the level. "),Object(a.b)("p",null,"To better understand how the generator works, we will first describe which post-processing is done by the generator itself and then provide ways to extend this behaviour and provide your own logic."),Object(a.b)("h2",{id:"built-in-post-processing-steps"},"Built-in post-processing steps"),Object(a.b)("h3",{id:"0-instantiate-room-template-with-correct-positions"},"0. Instantiate room template with correct positions"),Object(a.b)("p",null,"This is not actually a post-processing as it happens in the generator stage of the whole generator and cannot be disabled. At this point, the generator knows the final position and room template for each room in the level. The generator goes through the rooms and instantiates the corresponding room template game object and moves it to its correct position. If we disabled all the other post-processing steps, we would get a bunch of correctly positioned rooms but there would often be weird overlap between the rooms."),Object(a.b)("h3",{id:"1-initialize-shared-tilemaps"},"1. Initialize shared tilemaps"),Object(a.b)("p",null,"In this step, the generator initializes the structure of shared tilemaps to which we will copy individual rooms in the next step. These tilemaps will contain all the tiles in the level. If you provided your own ",Object(a.b)("em",{parentName:"p"},"Tilemap Layers Handler"),", this is the time it gets called."),Object(a.b)("h3",{id:"2-copy-rooms-to-shared-tilemaps"},"2. Copy rooms to shared tilemaps"),Object(a.b)("p",null,"In this step, the generator copies individual rooms to shared tilemaps. If we use corridors, it is important to first copy other rooms and only then corridors. By doing so, corridors will make holes into the walls of other rooms so we can go from one room to another."),Object(a.b)("h3",{id:"3-center-grid"},"3. Center grid"),Object(a.b)("p",null,"In this step, the whole level is moved in a way that its centre ends up at (0,0). This step is only used to make it easier to go through multiple generated levels without having to move the camera around."),Object(a.b)("h3",{id:"4-disable-room-template-renderers"},"4. Disable room template renderers"),Object(a.b)("p",null,"At this point, we display both tiles from shared tilemaps and tiles from individual room template game objects that we instantiated in the step 0. Therefore, we have to disable all tilemap renderers from individual room templates. "),Object(a.b)("p",null,"You may think why do not we just disable the whole room template. The reason for that is that there may be some additional game objects like lights, enemies, etc. and we do not want to lose that."),Object(a.b)("h3",{id:"5-disable-room-template-colliders"},"5. Disable room template colliders"),Object(a.b)("p",null,"The last step is very similar to the previous step. At this point, there are colliders from individual room templates that would prevent us from going from one room to another. We keep only the colliders that are set to trigger because these may be useful for example for ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"/Edgar-Unity-DocsArchive/docs/2.0.0-alpha.8/guides/current-room-detection"}),"Current room detection"),"."),Object(a.b)("h2",{id:"custom-post-processing"},"Custom post-processing"),Object(a.b)("p",null,"If we want to add our own post-processing logic, we have to create a class that inherits from ",Object(a.b)("inlineCode",{parentName:"p"},"DungeonGeneratorPostProcessBase"),". And because the base class is a ScriptableObject, we need to add the ",Object(a.b)("inlineCode",{parentName:"p"},"CreateAssetMenu")," attribute so we are able to create an instance of that ScriptableObject. After a level is generated, the ",Object(a.b)("inlineCode",{parentName:"p"},"Run")," method is called and that is the place where we put our post-processing logic."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),'[CreateAssetMenu(menuName = "Edgar/Examples/Docs/My custom post process", fileName = "MyCustomPostProcess")]\npublic class MyCustomPostProcess : DungeonGeneratorPostProcessBase\n{\n    public override void Run(GeneratedLevel level, LevelDescription levelDescription)\n    { \n        // Implement the logic here\n    }\n}\n')),Object(a.b)("p",null,"With the implementation ready, we now have to create an instance of that ScriptableObject by right-clicking in the project view and ",Object(a.b)("em",{parentName:"p"},"Create -> Edgar -> Examples -> Docs -> My custom post process"),". And the last step is to drag and drop this ScriptableObject in the ",Object(a.b)("em",{parentName:"p"},"Custom post process tasks")," section of the dungeon generator."),Object(a.b)(i.c,{src:"img/v2/examples/example1/custom_post_process.png",caption:"Add the ScriptableObject to the Custom post process tasks array",mdxType:"Image"}),Object(a.b)(s.b,{id:"custom-post-processing",mdxType:"FeatureUsage"}),Object(a.b)("h3",{id:"pro-priority-callbacks"},"(PRO) Priority callbacks"))}u.isMDXComponent=!0},371:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return h}));var o=r(0),n=r.n(o);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=n.a.createContext({}),p=function(e){var t=n.a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},d=function(e){var t=p(e.components);return n.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},m=n.a.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),d=p(r),m=o,h=d["".concat(i,".").concat(m)]||d[m]||u[m]||a;return r?n.a.createElement(h,s(s({ref:t},l),{},{components:r})):n.a.createElement(h,s({ref:t},l))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<a;l++)i[l]=r[l];return n.a.createElement.apply(null,i)}return n.a.createElement.apply(null,r)}m.displayName="MDXCreateElement"},372:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return i}));var o=r(22),n=r(373);function a(){const{siteConfig:{baseUrl:e="/",url:t}={}}=Object(o.default)();return{withBaseUrl:(r,o)=>function(e,t,r,{forcePrependBaseUrl:o=!1,absolute:a=!1}={}){if(!r)return r;if(r.startsWith("#"))return r;if(Object(n.b)(r))return r;if(o)return t+r;const i=r.startsWith(t)?r:t+r.replace(/^\//,"");return a?e+i:i}(t,e,r,o)}}function i(e,t={}){const{withBaseUrl:r}=a();return r(e,t)}},373:function(e,t,r){"use strict";function o(e){return!0===/^(\w*:|\/\/)/.test(e)}function n(e){return void 0!==e&&!o(e)}r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return n}))},374:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return d}));var o=r(3),n=r(0),a=r.n(n),i=r(372);const s=e=>a.a.createElement("div",{style:{display:"inline-block",margin:2,overflow:"hidden",position:"relative",width:`calc(${100/e.cols}% - 4px)`,verticalAlign:"top"}},e.children),c=e=>a.a.createElement("div",{style:{fontSize:"0px",margin:"20px 0"}},a.a.Children.map(e.children,(t=>a.a.cloneElement(t,{cols:e.cols||4,fixedHeight:e.fixedHeight})))),l=e=>a.a.createElement(s,{cols:e.cols},a.a.createElement("a",{href:Object(i.a)(e.src),target:"_blank"},a.a.createElement("img",{src:Object(i.a)(e.src),alt:"result",style:{height:!0===e.fixedHeight?800/e.cols+"px":"auto",objectFit:!0===e.fixedHeight?"cover":"initial"}})),void 0!==e.caption&&a.a.createElement(p,null,e.caption)),p=e=>a.a.createElement("div",{style:{fontSize:16,fontStyle:"italic",textAlign:"center",margin:"10px 0px 15px"}},e.children),d=e=>{const{src:t,caption:r,...n}=e;return a.a.createElement("div",{style:{textAlign:"center"}},a.a.createElement("img",Object(o.a)({src:Object(i.a)(e.src)},n)),void 0!==e.caption&&a.a.createElement(p,null,e.caption))}},375:function(e,t,r){"use strict";var o=r(0),n=r.n(o),a=r(11),i=r(373),s=r(8);const c=Object(o.createContext)({collectLink:()=>{}});var l=r(372),p=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r};t.a=function(e){var t,{isNavLink:r,to:d,href:u,activeClassName:m,isActive:h,"data-noBrokenLinkCheck":b,autoAddBaseUrl:f=!0}=e,g=p(e,["isNavLink","to","href","activeClassName","isActive","data-noBrokenLinkCheck","autoAddBaseUrl"]);const{withBaseUrl:v}=Object(l.b)(),w=Object(o.useContext)(c),y=d||u,O=Object(i.a)(y),j=null==y?void 0:y.replace("pathname://",""),E=void 0!==j?(x=j,f&&(e=>e.startsWith("/"))(x)?v(x):x):void 0;var x;const k=Object(o.useRef)(!1),C=r?a.e:a.c,P=s.a.canUseIntersectionObserver;let A;Object(o.useEffect)((()=>(!P&&O&&window.docusaurus.prefetch(E),()=>{P&&A&&A.disconnect()})),[E,P,O]);const N=null!==(t=null==E?void 0:E.startsWith("#"))&&void 0!==t&&t,D=!E||!O||N;return E&&O&&!N&&!b&&w.collectLink(E),D?n.a.createElement("a",Object.assign({href:E},y&&!O&&{target:"_blank",rel:"noopener noreferrer"},g)):n.a.createElement(C,Object.assign({},g,{onMouseEnter:()=>{k.current||(window.docusaurus.preload(E),k.current=!0)},innerRef:e=>{var t,r;P&&e&&O&&(t=e,r=()=>{window.docusaurus.prefetch(E)},A=new window.IntersectionObserver((e=>{e.forEach((e=>{t===e.target&&(e.isIntersecting||e.intersectionRatio>0)&&(A.unobserve(t),A.disconnect(),r())}))})),A.observe(t))},to:E||""},r&&{isActive:h,activeClassName:m}))}},376:function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return p}));var o=r(0),n=r.n(o),a=r(375);const i=[{id:"outline-override",url:"../basics/room-templates#outline-override",name:"Outline override",usages:[{id:"corridors",description:"Outline override is used to properly handle corridors"}]},{id:"custom-rooms-and-connections",url:"../basics/level-graphs#pro-custom-rooms-and-connections",name:"Custom rooms",usages:[{id:"room-type",description:"The definition of rooms is enhanced with a custom type"}]},{id:"custom-post-processing",url:"../generators/post-process#custom-post-processing",name:"Custom post-processing",usages:[{id:"enemies",description:"A custom post-processing task is used to spawn enemies after a level is generated"},{id:"player-spawn",description:"Move the player to the spawn position of the level"}]}],s=[{id:"example-1",name:"Example 1",url:"../examples/example-1",features:[{id:"custom-post-processing",usage:"enemies",anchor:"enemies"}]},{id:"example-2",name:"Example 2",url:"../examples/example-2",features:[{id:"outline-override",usage:"corridors",anchor:"vertical-corridors"}]},{id:"dead-cells",name:"Dead Cells",url:"../examples/dead-cells",features:[{id:"custom-post-processing",usage:"enemies",anchor:"enemies"},{id:"custom-post-processing",usage:"player-spawn",anchor:"spawn-position"},{id:"custom-rooms-and-connections",usage:"room-type",anchor:"custom-room-and-connection-types"}]}];function c(e){if("undefined"!=typeof window){const t=window.location.href,r=t.split("/");(r[r.length-1].startsWith("#")||t.endsWith("/"))&&(e="../"+e)}return e}const l=e=>{const t=i.find((t=>t.id===e.id)).usages.map((e=>({...e,examples:[]})));return s.forEach((r=>{r.features.forEach((o=>{if(o.id===e.id){t.find((e=>e.id===o.usage)).examples.push({example:r,feature:o})}}))})),n.a.createElement("div",{className:"featureUsage"},n.a.createElement("div",{className:"featureUsage__title"},"Where is this feature used?"),n.a.createElement("div",{className:"featureUsage__description"},"Below is the list of examples/tutorials where we use this feature. Feel free to check them out if you're not sure how something works or if you just want to see this feature used in action."),n.a.createElement("table",null,n.a.createElement("tbody",null,t.map(((e,t)=>n.a.createElement("tr",{key:t},n.a.createElement("td",null,e.examples.map(((e,t)=>n.a.createElement("span",null,t?", ":"",n.a.createElement(a.a,{to:c(e.example.url+"#"+e.feature.anchor),onClick:()=>{return t=e.feature.anchor,void setTimeout((function(){var e=document.getElementById(t);e&&e.scrollIntoView()}),1e3);var t}},e.example.name))))),n.a.createElement("td",null,e.description)))))))},p=e=>{const t=s.find((t=>t.id===e.id)),r=[];return t.features.forEach((e=>{const t=i.find((t=>t.id===e.id)),o=t.usages.find((t=>t.id===e.usage));r.push({...e,feature:t,featureUsage:o})})),n.a.createElement("div",{className:"featureUsage"},n.a.createElement("div",{className:"featureUsage__title"},"List of used features"),n.a.createElement("div",{className:"featureUsage__description"},"Below is a list of features that are used in this example."),n.a.createElement("table",null,n.a.createElement("tbody",null,r.map(((e,t)=>n.a.createElement("tr",{key:t},n.a.createElement("td",null,n.a.createElement(a.a,{to:e.feature.url},e.feature.name)),n.a.createElement("td",null,e.featureUsage.description)))))))}}}]);